<script type="text/javascript">
    $(document).ready(function () {
        var pdata = jQuery.getJSON('nodos.json?model=empresas', function (data){ 
        var source =
        {
            datatype: "json",
            datafields: [
                { name: 'id' },
                { name: 'padre_id' },
                { name: 'nombre' }
            ],
            id: 'id',
            localdata: data
                            };
        // create data adapter.
        var dataAdapter = new $.jqx.dataAdapter(source);
        // perform Data Binding.
        dataAdapter.dataBind();
        // get the tree items. The first parameter is the item's id. The second parameter is the parent item's id. The 'items' parameter represents 
        // the sub items collection name. Each jqxTree item has a 'label' property, but in the JSON data, we have a 'text' field. The last parameter 
        // specifies the mapping between the 'text' and 'label' fields.  
        var records = dataAdapter.getRecordsHierarchy('id', 'padre_id', 'items', [{ name: 'nombre', map: 'label'}]);
        $('#jqxTree').jqxTree({ source: records, width: '100%'});
        $('#jqxTree').jqxTree('expandAll');
    });
$("#jqxTree").on('dragEnd', function (event) {
    // get item's label.
    var itemLabel = event.args.id;
    // get item's value.
    var itemValue = event.args.value;
    // get the original dragStart event from the jqxDragDrop plug-in.
    $.ajax({
  type: "PATCH",
  url: 'nodos/' + $('#jqxTree').jqxTree('getSelectedItem').id,
  data: { rba_nodo: {padre_id: $('#jqxTree').jqxTree('getSelectedItem').parentElement.id }},
  dataType: "json"
            });
    
            });
});
</script>
<div class="small-3 columns index">
	<div class="panel">
		<div id="jqxTree">
		
		</div>
	</div>
</div>
