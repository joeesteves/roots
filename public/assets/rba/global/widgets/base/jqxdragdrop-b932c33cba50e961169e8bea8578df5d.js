!function(e){e.jqx.jqxWidget("jqxDragDrop","",{}),e.extend(e.jqx._jqxDragDrop.prototype,{defineInstance:function(){this.restricter="document",this.handle=!1,this.feedback="clone",this.opacity=.6,this.revert=!1,this.revertDuration=400,this.distance=5,this.disabled=!1,this.tolerance="intersect",this.data=null,this.dropAction="default",this.dragZIndex=999999,this.appendTo="parent",this.cursor="move",this.onDragEnd=null,this.onDrag=null,this.onDragStart=null,this.onTargetDrop=null,this.onDropTargetEnter=null,this.onDropTargetLeave=null,this.initFeedback=null,this.dropTarget=null,this.isDestroyed=!1,this.triggerEvents=!0,this._touchEvents={mousedown:e.jqx.mobile.getTouchEventName("touchstart"),click:e.jqx.mobile.getTouchEventName("touchstart"),mouseup:e.jqx.mobile.getTouchEventName("touchend"),mousemove:e.jqx.mobile.getTouchEventName("touchmove"),mouseenter:"mouseenter",mouseleave:"mouseleave"},this._restricter=null,this._zIndexBackup=0,this._targetEnterFired=!1,this._oldOpacity=1,this._feedbackType,this._isTouchDevice=!1,this._events=["dragStart","dragEnd","dragging","dropTargetEnter","dropTargetLeave"]},createInstance:function(){this._createDragDrop()},_createDragDrop:function(){var t=e.data(document.body,"jqx-draggables")||1;if(this.appendTo=this._getParent(),this._isTouchDevice=e.jqx.mobile.isTouchDevice(),/(static|relative)/.test(this.host.css("position"))&&(!this.feedback||"original"===this.feedback)){var i=this._getRelativeOffset(this.host),r=this.appendTo.offset();"static"!=this.appendTo.css("position")&&(r={left:0,top:0}),this.element.style.position="absolute",this.element.style.left=r.left+i.left+"px",this.element.style.top=r.top+i.top+"px"}this._validateProperties(),this._idHandler(t),this.disabled&&this.disable(),"string"==typeof this.dropTarget&&(this.dropTarget=e(this.dropTarget)),this._refresh(),t+=1,e.data(document.body,"jqx-draggables",t),this.host.addClass("jqx-draggable"),this.disabled||this.host.css("cursor",this.cursor)},_getParent:function(){var t=this.appendTo;if("string"==typeof this.appendTo)switch(this.appendTo){case"parent":t=this.host.parent();break;case"document":t=e(document);break;case"body":t=e(document.body);break;default:t=e(this.appendTo)}return t},_idHandler:function(e){if(!this.element.id){var t="jqx-draggable-"+e;this.element.id=t}},_refresh:function(){this._removeEventHandlers(),this._addEventHandlers()},_getEvent:function(e){return this._isTouchDevice?this._touchEvents[e]:e},_validateProperties:function(){this._feedbackType="clone"===this.feedback?"clone":"original","default"!==this.dropAction&&(this.dropAction="nothing")},_removeEventHandlers:function(){this.removeHandler(this.host,"dragstart"),this.removeHandler(this.host,this._getEvent("mousedown")+".draggable."+this.element.id,this._mouseDown),this.removeHandler(e(document),this._getEvent("mousemove")+".draggable."+this.element.id,this._mouseMove),this.removeHandler(e(document),this._getEvent("mouseup")+".draggable."+this.element.id,this._mouseUp)},_addEventHandlers:function(){var t=this;this.addHandler(this.host,"dragstart",function(i){if(t.disabled)return!0;var r=e.jqx.mobile.isTouchDevice();return r?void 0:(i.preventDefault(),!1)}),this.addHandler(this.host,this._getEvent("mousedown")+".draggable."+this.element.id,this._mouseDown,{self:this}),this.addHandler(e(document),this._getEvent("mousemove")+".draggable."+this.element.id,this._mouseMove,{self:this}),this.addHandler(e(document),this._getEvent("mouseup")+".draggable."+this.element.id,this._mouseUp,{self:this});try{if((""!=document.referrer||window.frameElement)&&null!=window.top&&window.top!=window.self){var i="";if(window.parent&&document.referrer&&(i=document.referrer),-1!=i.indexOf(document.location.host)){var r=function(){t._mouseUp(t)};window.top.document.addEventListener?window.top.document.addEventListener("mouseup",r,!1):window.top.document.attachEvent&&window.top.document.attachEvent("onmouseup",r)}}}catch(s){}},_mouseDown:function(e){var t=e.data.self,i=t._getMouseCoordinates(e),r=t._mouseCapture(e);if(t._originalPageX=i.left,t._originalPageY=i.top,t.disabled)return!0;var s=!1;return t._mouseStarted||(t._mouseUp(e),s=!0),r&&(t._mouseDownEvent=e),t._isTouchDevice?!0:1===e.which&&r?void e.preventDefault():!0},_mouseMove:function(e){var t=e.data.self;return t.disabled?!0:t._mouseStarted?(t._mouseDrag(e),e.preventDefault&&e.preventDefault(),!1):(t._mouseDownEvent&&t._isMovedDistance(e)&&(t._mouseStarted=t._mouseStart(t._mouseDownEvent,e)?!0:!1,t._mouseStarted?t._mouseDrag(e):t._mouseUp(e)),!t._mouseStarted)},_mouseUp:function(e){var t;return t=e.data&&e.data.self?e.data.self:this,t.disabled?!0:(t._mouseDownEvent=!1,t._movedDistance=!1,t._mouseStarted&&(t._mouseStarted=!1,t._mouseStop(e)),t.feedback&&t.feedback[0]&&"original"!==t._feedbackType&&"function"==typeof t.feedback.remove&&!t.revert&&t.feedback.remove(),t._isTouchDevice?void 0:!1)},cancelDrag:function(){var e=this.revertDuration;this.revertDuration=0,this._mouseDownEvent=!1,this._movedDistance=!1,this._mouseStarted=!1,this._mouseStop(),this.feedback.remove(),this.revertDuration=e},_isMovedDistance:function(e){var t=this._getMouseCoordinates(e);return this._movedDistance?!0:t.left>=this._originalPageX+this.distance||t.left<=this._originalPageX-this.distance||t.top>=this._originalPageY+this.distance||t.top<=this._originalPageY-this.distance?(this._movedDistance=!0,!0):!1},_getMouseCoordinates:function(t){if(this._isTouchDevice){var i=e.jqx.position(t);return{left:i.left,top:i.top}}return{left:t.pageX,top:t.pageY}},destroy:function(){return this._enableSelection(this.host),this.host.removeData("draggable").off(".draggable").removeClass("jqx-draggable jqx-draggable-dragging jqx-draggable-disabled"),this._removeEventHandlers(),this.isDestroyed=!0,this},_disableSelection:function(t){t.each(function(){e(this).attr("unselectable","on").css({"-ms-user-select":"none","-moz-user-select":"none","-webkit-user-select":"none","user-select":"none"}).each(function(){this.onselectstart=function(){return!1}})})},_enableSelection:function(t){t.each(function(){e(this).attr("unselectable","off").css({"-ms-user-select":"text","-moz-user-select":"text","-webkit-user-select":"text","user-select":"text"}).each(function(){this.onselectstart=null})})},_mouseCapture:function(e){return this.disabled?!1:this._getHandle(e)?(this._disableSelection(this.host),!0):!1},_getScrollParent:function(t){var i;return i=e.jqx.browser.msie&&/(static|relative)/.test(t.css("position"))||/absolute/.test(t.css("position"))?t.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position",1))&&/(auto|scroll)/.test(e.css(this,"overflow",1)+e.css(this,"overflow-y",1)+e.css(this,"overflow-x",1))}).eq(0):t.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow",1)+e.css(this,"overflow-y",1)+e.css(this,"overflow-x",1))}).eq(0),/fixed/.test(t.css("position"))||!i.length?e(document):i},_mouseStart:function(t){{var i=this._getMouseCoordinates(t);this._getParentOffset(this.host)}this.feedback=this._createFeedback(t),this._zIndexBackup=this.feedback.css("z-index"),this.feedback[0].style.zIndex=this.dragZIndex,this._backupFeedbackProportions(),this._backupeMargins(),this._positionType=this.feedback.css("position"),this._scrollParent=this._getScrollParent(this.feedback),this._offset=this.positionAbs=this.host.offset(),this._offset={top:this._offset.top-this.margins.top,left:this._offset.left-this.margins.left},e.extend(this._offset,{click:{left:i.left-this._offset.left,top:i.top-this._offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset(),hostRelative:this._getRelativeOffset(this.host)}),this.position=this._generatePosition(t),this.originalPosition=this._fixPosition(),this.restricter&&this._setRestricter(),this.feedback.addClass(this.toThemeProperty("jqx-draggable-dragging"));this._raiseEvent(0,t);return this.onDragStart&&"function"==typeof this.onDragStart&&this.onDragStart(this.position),this._mouseDrag(t,!0),!0},_fixPosition:function(){var e=this._getRelativeOffset(this.host),t=this.position;return t={left:this.position.left+e.left,top:this.position.top+e.top}},_mouseDrag:function(e){return this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.feedback[0].style.left=this.position.left+"px",this.feedback[0].style.top=this.position.top+"px",this._raiseEvent(2,e),this.onDrag&&"function"==typeof this.onDrag&&this.onDrag(this.data,this.position),this._handleTarget(),!1},_over:function(t,i,r){if(this.dropTarget){var s=!1,o=this;e.each(this.dropTarget,function(e,a){return s=o._overItem(a,t,i,r),s.over?!1:void 0})}return s},_overItem:function(t,i,r,s){t=e(t);var o,a=t.offset(),n=t.outerHeight(),l=t.outerWidth();if(t&&t[0]!==this.element){var o=!1;switch(this.tolerance){case"intersect":i.left+r>a.left&&i.left<a.left+l&&i.top+s>a.top&&i.top<a.top+n&&(o=!0);break;case"fit":r+i.left<=a.left+l&&i.left>=a.left&&s+i.top<=a.top+n&&i.top>=a.top&&(o=!0)}return{over:o,target:t}}},_handleTarget:function(){if(this.dropTarget){var e=this.feedback.offset(),t=this.feedback.outerWidth(),i=this.feedback.outerHeight(),r=this._over(e,t,i);r.over?(this._targetEnterFired&&r.target.length>0&&this._oldtarget&&this._oldtarget.length>0&&r.target[0]!=this._oldtarget[0]&&(this._raiseEvent(4,{target:this._oldtarget}),this.onDropTargetLeave&&"function"==typeof this.onDropTargetLeave&&this.onDropTargetLeave(this._oldtarget)),(!this._targetEnterFired||r.target.length>0&&this._oldtarget&&this._oldtarget.length>0&&r.target[0]!=this._oldtarget[0])&&(this._targetEnterFired=!0,this._raiseEvent(3,{target:r.target}),this.onDropTargetEnter&&"function"==typeof this.onDropTargetEnter&&this.onDropTargetEnter(r.target)),this._oldtarget=r.target):this._targetEnterFired&&(this._targetEnterFired=!1,this._raiseEvent(4,{target:this._oldtarget||r.target}),this.onDropTargetLeave&&"function"==typeof this.onDropTargetLeave&&this.onDropTargetLeave(this._oldtarget||r.target))}},_mouseStop:function(e){var t=!1,i=this._fixPosition(),r={width:this.host.outerWidth(),height:this.host.outerHeight()};return this.feedback[0].style.opacity=this._oldOpacity,this.revert||(this.feedback[0].style.zIndex=this._zIndexBackup),this._enableSelection(this.host),this.dropped&&(t=this.dropped,this.dropped=!1),this.element&&this.element.parentNode||"original"!==this.feedback?(this._dropElement(i),this.feedback.removeClass(this.toThemeProperty("jqx-draggable-dragging")),this._raiseEvent(1,e),this.onDragEnd&&"function"==typeof this.onDragEnd&&this.onDragEnd(this.data),this.onTargetDrop&&"function"==typeof this.onTargetDrop&&this._over(i,r.width,r.height).over&&this.onTargetDrop(this._over(i,r.width,r.height).target),this._revertHandler(),!1):!1},_dropElement:function(e){if("default"===this.dropAction&&this.feedback&&this.feedback[0]!==this.element&&"original"!==this.feedback&&!this.revert&&!/(fixed|absolute)/.test(this.host.css("position"))){this.host.css("position","relative");var t=this._getRelativeOffset(this.host);e=this.position,e.left-=t.left,e.top-=t.top,this.element.style.left=e.left+"px",this.element.style.top=e.top+"px"}},_revertHandler:function(){if(this.revert||e.isFunction(this.revert)&&this.revert()){var t=this;"original"!=this._feedbackType?null!=this.feedback&&("none"!=this.dropAction?e(this.feedback).animate({left:t.originalPosition.left-t._offset.hostRelative.left,top:t.originalPosition.top-t._offset.hostRelative.top},parseInt(this.revertDuration,10),function(){t.feedback&&t.feedback[0]&&"original"!==t._feedbackType&&"function"==typeof t.feedback.remove&&t.feedback.remove()}):t.feedback&&t.feedback[0]&&"original"!==t._feedbackType&&"function"==typeof t.feedback.remove&&t.feedback.remove()):(this.element.style.zIndex=this.dragZIndex,e(this.host).animate({left:t.originalPosition.left-t._offset.hostRelative.left,top:t.originalPosition.top-t._offset.hostRelative.top},parseInt(this.revertDuration,10),function(){t.element.style.zIndex=t._zIndexBackup}))}},_getHandle:function(t){var i;return this.handle?e(this.handle,this.host).find("*").andSelf().each(function(){this==t.target&&(i=!0)}):i=!0,i},_createFeedback:function(){var e;if(e="function"==typeof this._feedbackType?this._feedbackType():"clone"===this._feedbackType?this.host.clone().removeAttr("id"):this.host,/(absolute|fixed)/.test(e.css("position"))||e.css("position","absolute"),this.appendTo[0]!==this.host.parent()[0]||e[0]!==this.element){e.css({left:this.host.offset().left-this._getParentOffset(this.host).left+this._getParentOffset(e).left,top:this.host.offset().top-this._getParentOffset(this.host).top+this._getParentOffset(e).top}),e.appendTo(this.appendTo)}return"function"==typeof this.initFeedback&&this.initFeedback(e),e},_getParentOffset:function(t){var t=t||this.feedback;this._offsetParent=t.offsetParent();var i=this._offsetParent.offset();return"absolute"==this._positionType&&this._scrollParent[0]!==document&&e.contains(this._scrollParent[0],this._offsetParent[0])&&(i.left+=this._scrollParent.scrollLeft(),i.top+=this._scrollParent.scrollTop()),(this._offsetParent[0]==document.body||this._offsetParent[0].tagName&&"html"==this._offsetParent[0].tagName.toLowerCase()&&e.jqx.browser.msie)&&(i={top:0,left:0}),{top:i.top+(parseInt(this._offsetParent.css("border-top-width"),10)||0),left:i.left+(parseInt(this._offsetParent.css("border-left-width"),10)||0)}},_getRelativeOffset:function(e){this._scrollParent||e.parent();if(e=e||this.feedback,"relative"===e.css("position")){var t=this.host.position();return{top:t.top-(parseInt(e.css("top"),10)||0),left:t.left-(parseInt(e.css("left"),10)||0)}}return{top:0,left:0}},_backupeMargins:function(){this.margins={left:parseInt(this.host.css("margin-left"),10)||0,top:parseInt(this.host.css("margin-top"),10)||0,right:parseInt(this.host.css("margin-right"),10)||0,bottom:parseInt(this.host.css("margin-bottom"),10)||0}},_backupFeedbackProportions:function(){this.feedback[0].style.opacity=this.opacity,this._feedbackProportions={width:this.feedback.outerWidth(),height:this.feedback.outerHeight()}},_setRestricter:function(){"parent"==this.restricter&&(this.restricter=this.feedback[0].parentNode),("document"==this.restricter||"window"==this.restricter)&&this._handleNativeRestricter(),"undefined"!=typeof this.restricter.left&&"undefined"!=typeof this.restricter.top&&"undefined"!=typeof this.restricter.height&&"undefined"!=typeof this.restricter.width?this._restricter=[this.restricter.left,this.restricter.top,this.restricter.width,this.restricter.height]:/^(document|window|parent)$/.test(this.restricter)||this.restricter.constructor==Array?this.restricter.constructor==Array&&(this._restricter=this.restricter):this._handleDOMParentRestricter()},_handleNativeRestricter:function(){this._restricter=["document"===this.restricter?0:e(window).scrollLeft()-this._offset.relative.left-this._offset.parent.left,"document"===this.restricter?0:e(window).scrollTop()-this._offset.relative.top-this._offset.parent.top,("document"===this.restricter?0:e(window).scrollLeft())+e("document"===this.restricter?document:window).width()-this._feedbackProportions.width-this.margins.left,("document"===this.restricter?0:e(window).scrollTop())+(e("document"===this.restricter?document:window).height()||document.body.parentNode.scrollHeight)-this._feedbackProportions.height-this.margins.top]},_handleDOMParentRestricter:function(){var t=e(this.restricter),i=t[0];if(i){var r="hidden"!==e(i).css("overflow");this._restricter=[(parseInt(e(i).css("borderLeftWidth"),10)||0)+(parseInt(e(i).css("paddingLeft"),10)||0),(parseInt(e(i).css("borderTopWidth"),10)||0)+(parseInt(e(i).css("paddingTop"),10)||0),(r?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(e(i).css("borderLeftWidth"),10)||0)-(parseInt(e(i).css("paddingRight"),10)||0)-this._feedbackProportions.width-this.margins.left-this.margins.right,(r?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(e(i).css("borderTopWidth"),10)||0)-(parseInt(e(i).css("paddingBottom"),10)||0)-this._feedbackProportions.height-this.margins.top-this.margins.bottom],this._restrictiveContainer=t}},_convertPositionTo:function(t,i){i||(i=this.position);var r,s,o;return r="absolute"===t?1:-1,s="absolute"!==this._positionType||this._scrollParent[0]!=document&&e.contains(this._scrollParent[0],this._offsetParent[0])?this._scrollParent:this._offsetParent,o=/(html|body)/i.test(s[0].tagName),this._getPosition(i,r,o,s)},_getPosition:function(t,i,r,s){return{top:t.top+this._offset.relative.top*i+this._offset.parent.top*i-(e.jqx.browser.safari&&e.jqx.browser.version<526&&"fixed"==this._positionType?0:("fixed"==this._positionType?-this._scrollParent.scrollTop():r?0:s.scrollTop())*i),left:t.left+this._offset.relative.left*i+this._offset.parent.left*i-(e.jqx.browser.safari&&e.jqx.browser.version<526&&"fixed"==this._positionType?0:("fixed"==this._positionType?-this._scrollParent.scrollLeft():r?0:s.scrollLeft())*i)}},_generatePosition:function(t){var i="absolute"!=this._positionType||this._scrollParent[0]!=document&&e.contains(this._scrollParent[0],this._offsetParent[0])?this._scrollParent:this._offsetParent,r=/(html|body)/i.test(i[0].tagName),s=this._getMouseCoordinates(t),o=s.left,a=s.top;if(this.originalPosition){var n;if(this.restricter){if(this._restrictiveContainer){var l=this._restrictiveContainer.offset();n=[this._restricter[0]+l.left,this._restricter[1]+l.top,this._restricter[2]+l.left,this._restricter[3]+l.top]}else n=this._restricter;s.left-this._offset.click.left<n[0]&&(o=n[0]+this._offset.click.left),s.top-this._offset.click.top<n[1]&&(a=n[1]+this._offset.click.top),s.left-this._offset.click.left>n[2]&&(o=n[2]+this._offset.click.left),s.top-this._offset.click.top>n[3]&&(a=n[3]+this._offset.click.top)}}return{top:a-this._offset.click.top-this._offset.relative.top-this._offset.parent.top+(e.jqx.browser.safari&&e.jqx.browser.version<526&&"fixed"==this._positionType?0:"fixed"==this._positionType?-this._scrollParent.scrollTop():r?0:i.scrollTop()),left:o-this._offset.click.left-this._offset.relative.left-this._offset.parent.left+(e.jqx.browser.safari&&e.jqx.browser.version<526&&"fixed"==this._positionType?0:"fixed"==this._positionType?-this._scrollParent.scrollLeft():r?0:i.scrollLeft())}},_raiseEvent:function(t,i){if(void 0==this.triggerEvents||0!=this.triggerEvents){var r=this._events[t],s=e.Event(r),i=i||{};return i.position=this.position,i.element=this.element,e.extend(i,this.data),i.feedback=this.feedback,s.args=i,this.host.trigger(s)}},disable:function(){this.disabled=!0,this.host.addClass(this.toThemeProperty("jqx-draggable-disabled")),this._enableSelection(this.host)},enable:function(){this.disabled=!1,this.host.removeClass(this.toThemeProperty("jqx-draggable-disabled"))},propertyChangedHandler:function(t,i,r,s){"dropTarget"===i?"string"==typeof s&&(t.dropTarget=e(s)):"disabled"==i?s&&t._enableSelection(t.host):"cursor"==i&&t.host.css("cursor",t.cursor)}})}(jQuery),function(e){jqxListBoxDragDrop=function(){e.extend(e.jqx._jqxListBox.prototype,{_hitTestBounds:function(e,t,i){var r=e.host.offset(),s=i-parseInt(r.top),o=t-parseInt(r.left),a=e._hitTest(o,s);if(0>s)return null;if(null!=a){var n=parseInt(r.left),l=n+e.host.width();return n<=t+a.width/2&&l>=t?a:null}if(e.items&&e.items.length>0){var h=e.items[e.items.length-1];if(h.top+h.height+15>=s)return h}return null},_handleDragStart:function(t,i){var r=e.jqx.mobile.isTouchDevice();r&&i.allowDrag&&t.on(e.jqx.mobile.getTouchEventName("touchstart"),function(){e.jqx.mobile.setTouchScroll(!1,i.element.id)}),t.off("dragStart"),t.on("dragStart",function(t){if(i.allowDrag&&!i.disabled){i.feedbackElement=e("<div style='z-index: 99999; position: absolute;'></div>"),i.feedbackElement.addClass(i.toThemeProperty("jqx-listbox-feedback")),i.feedbackElement.appendTo(e(document.body)),i.feedbackElement.hide(),i.isDragging=!0,i._dragCancel=!1;var r=i._getMouseCoordinates(t),s=i._hitTestBounds(i,r.left,r.top),o=e.find(".jqx-listbox");i._listBoxes=o,e.each(i._listBoxes,function(){var t=e.data(this,"jqxListBox").instance;t._enableHover=t.enableHover,t.enableHover=!1,e.jqx.mobile.setTouchScroll(!1,i.element.id)});var a=function(){i._dragCancel=!0,e(t.args.element).jqxDragDrop({triggerEvents:!1}),e(t.args.element).jqxDragDrop("cancelDrag"),clearInterval(i._autoScrollTimer),e(t.args.element).jqxDragDrop({triggerEvents:!0}),e.each(i._listBoxes,function(){var t=e.data(this,"jqxListBox").instance;void 0!=t._enableHover&&(t.enableHover=t._enableHover,e.jqx.mobile.setTouchScroll(!0,i.element.id))})};if(null==s||s.isGroup)null==s&&a();else{if(i._dragItem=s,i.dragStart){var n=i.dragStart(s);if(0==n)return a(),!1}s.disabled&&a(),i._raiseEvent(4,{label:s.label,value:s.value,originalEvent:t.args})}}return!1})},_handleDragging:function(t,i){t.off("dragging"),t.on("dragging",function(t){var r=t.args;if(!i._dragCancel){var s=i._getMouseCoordinates(t),o=s;i._lastDraggingPosition=s,i._dragOverItem=null,i.feedbackElement.hide(),e.each(i._listBoxes,function(){if(e.jqx.isHidden(e(this)))return!0;var t=e(this).offset(),a=t.top+20,n=e(this).height()+a-40,l=t.left,h=e(this).width(),d=l+h,c=e.data(this,"jqxListBox").instance,f=c._hitTestBounds(c,s.left,s.top),g=c.vScrollInstance;if(null!=f&&c.allowDrop&&!c.disabled&&(i._dragOverItem=f,f.element)){i.feedbackElement.show();var p=e(f.element).offset().top+1;o.top>p+f.height/2&&(p+=f.height),i.feedbackElement.css("top",p),i.feedbackElement.css("left",l),i.feedbackElement.width("visible"!=c.vScrollBar.css("visibility")?e(this).width():e(this).width()-20)}s.left>=l&&s.left<d?r.position.top<a&&r.position.top>=a-30?(clearInterval(c._autoScrollTimer),0!=g.value&&i.feedbackElement.hide(),c._autoScrollTimer=setInterval(function(){var e=c.scrollUp();e||clearInterval(c._autoScrollTimer)},100)):r.position.top>n&&r.position.top<n+30?(clearInterval(c._autoScrollTimer),"hidden"!=c.vScrollBar.css("visibility")&&g.value!=g.max&&i.feedbackElement.hide(),c._autoScrollTimer=setInterval(function(){var e=c.scrollDown();e||clearInterval(c._autoScrollTimer)},100)):clearInterval(c._autoScrollTimer):(null==i._dragOverItem&&i.feedbackElement.hide(),clearInterval(c._autoScrollTimer))})}})},_handleDragEnd:function(t,i){e.find(".jqx-listbox");t.off("dragEnd"),t.on("dragEnd",function(t){clearInterval(i._autoScrollTimer);var r=e.jqx.mobile.isTouchDevice(),s=r?i._lastDraggingPosition:i._getMouseCoordinates(t),o=e.find(".jqx-listbox"),a=null;if(i.feedbackElement.remove(),!i._dragCancel){e.each(o,function(){if(e.jqx.isHidden(e(this)))return!0;var t=parseInt(e(this).offset().left),r=t+e(this).width(),o=e.data(this,"jqxListBox").instance;if(clearInterval(o._autoScrollTimer),void 0!=o._enableHover&&(o.enableHover=o._enableHover,e.jqx.mobile.setTouchScroll(!0,i.element.id)),null!=i._dragItem&&s.left+i._dragItem.width/2>=t&&s.left<r){var n=parseInt(e(this).offset().top),l=n+e(this).height();s.top>=n&&s.top<=l&&(a=e(this))}});var n=i._dragItem;if(null!=a&&a.length>0){var l=e.data(a[0],"jqxListBox").instance,h=l.allowDrop;if(h&&!l.disabled){var l=e.data(a[0],"jqxListBox").instance,d=l._hitTestBounds(l,s.left,s.top);if(d=i._dragOverItem,null==d||d.isGroup){if("none"!=l.dropAction){if(l.content.find(".draggable").length>0&&l.content.find(".draggable").jqxDragDrop("destroy"),i.dragEnd){var c=i.dragEnd(i._dragItem,null,t.args);if(0==c)return e(t.args.element).jqxDragDrop({triggerEvents:!1}),e(t.args.element).jqxDragDrop("cancelDrag"),clearInterval(i._autoScrollTimer),e(t.args.element).jqxDragDrop({triggerEvents:!0}),t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),!1;void 0==c&&(c=!0)}l.addItem(i._dragItem),"default"==l.dropAction&&(n.index>0&&i.selectIndex(n.index-1),i.removeItem(n,!0)),l.clearSelection(),l.selectIndex(l.items.length-1)}}else{var c=!0;if(i.dragEnd){if(c=i.dragEnd(n,d,t.args),0==c)return e(t.args.element).jqxDragDrop({triggerEvents:!1}),e(t.args.element).jqxDragDrop("cancelDrag"),clearInterval(i._autoScrollTimer),e(t.args.element).jqxDragDrop({triggerEvents:!0}),t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),!1;void 0==c&&(c=!0)}if(c){var f=(d.index,function(){for(var e=d.index,t=e-2;e+2>=t;t++)if(l.items&&l.items.length>t){var i=l.items[t];if(null!=i&&i.value==n.value)return t}return e});if("none"!=l.dropAction){var g=e(d.element).offset().top+1;l.content.find(".draggable").length>0&&l.content.find(".draggable").jqxDragDrop("destroy"),s.top>g+d.height/2?l.insertAt(i._dragItem,d.index+1):l.insertAt(i._dragItem,d.index),"default"==i.dropAction&&(n.index>0&&i.selectIndex(n.index-1),i.removeItem(n,!0));var p=f();l.clearSelection(),l.selectIndex(p)}}}}}else if(i.dragEnd){var u=i.dragEnd(n,t.args);if(0==u)return t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),!1}return null!=n&&i._raiseEvent(5,{label:n.label,value:n.value,originalEvent:t.args}),!1}})},_enableDragDrop:function(){if(this.allowDrag&&this.host.jqxDragDrop){var t=this.content.find(".draggable");if(t.length>0){var i=this;t.jqxDragDrop({cursor:"arrow",revertDuration:0,appendTo:"body",dragZIndex:99999,revert:!0,initFeedback:function(t){var r=e('<span style="white-space: nowrap;" class="'+i.toThemeProperty("jqx-fill-state-normal")+'">'+t.text()+"</span>");e(document.body).append(r);var s=r.width();r.remove(),t.width(s+5),t.addClass(i.toThemeProperty("jqx-fill-state-pressed"))}}),this._autoScrollTimer=null,i._dragItem=null,i._handleDragStart(t,i),i._handleDragging(t,i),i._handleDragEnd(t,i)}}},_getMouseCoordinates:function(t){if(this._isTouchDevice=e.jqx.mobile.isTouchDevice(),this._isTouchDevice){var i=e.jqx.position(t.args);return{left:i.left,top:i.top}}return{left:t.args.pageX,top:t.args.pageY}}})},jqxTreeDragDrop=function(){e.extend(e.jqx._jqxTree.prototype,{_hitTestBounds:function(t,i,r){var s=null;if(t._visibleItems){var o=parseInt(t.host.offset().left),a=t.host.outerWidth();e.each(t._visibleItems,function(){if(i>=o&&o+a>i&&this.top+5<r&&r<this.top+this.height){var n=e(this.element).parents("li:first");if(n.length>0&&(s=t.getItem(n[0]),null!=s))return s.height=this.height,s.top=this.top,!1}})}return s},_handleDragStart:function(t,i){i._dragOverItem&&i._dragOverItem.titleElement.removeClass(i.toThemeProperty("jqx-fill-state-hover"));var r=e.jqx.mobile.isTouchDevice();r&&i.allowDrag&&t.on(e.jqx.mobile.getTouchEventName("touchstart"),function(){e.jqx.mobile.setTouchScroll(!1,"panel"+i.element.id)}),t.off("dragStart"),t.on("dragStart",function(t){i.feedbackElement=e("<div style='z-index: 99999; position: absolute;'></div>"),i.feedbackElement.addClass(i.toThemeProperty("jqx-listbox-feedback")),i.feedbackElement.appendTo(e(document.body)),i.feedbackElement.hide(),i._dragCancel=!1;var r=(t.args.position,e.find(".jqx-tree"));return i._trees=r,e.each(r,function(){var r=e.data(this,"jqxTree").instance,s=r.host.find(".draggable");if(r._syncItems(s),r.allowDrag&&!r.disabled){var o=e(t.target).parents("li:first");if(o.length>0){var a=r.getItem(o[0]);if(a){if(i._dragItem=a,r.dragStart){var n=r.dragStart(a);if(0==n)return i._dragCancel=!0,e(t.args.element).jqxDragDrop({triggerEvents:!1}),e(t.args.element).jqxDragDrop("cancelDrag"),clearInterval(i._autoScrollTimer),e(t.args.element).jqxDragDrop({triggerEvents:r}),!1}r._raiseEvent(8,{label:a.label,value:a.value,originalEvent:t.args})}}}}),!1})},_getMouseCoordinates:function(t){if(this._isTouchDevice=e.jqx.mobile.isTouchDevice(),this._isTouchDevice){var i=e.jqx.position(t.args);return{left:i.left,top:i.top}}return{left:t.args.pageX,top:t.args.pageY}},_handleDragging:function(t,i){var t=this.host.find(".draggable");t.off("dragging"),t.on("dragging",function(t){var r=t.args,s=(r.position,i._trees);if(!i._dragCancel){i._dragOverItem&&i._dragOverItem.titleElement.removeClass(i.toThemeProperty("jqx-fill-state-hover"));var o=!0,a=i._getMouseCoordinates(t);i._lastDraggingPosition=a,e.each(s,function(){if(e.jqx.isHidden(e(this)))return!0;var t=e(this).offset(),r=t.top+20,s=e(this).height()+r-40,n=t.left,l=e(this).width(),h=n+l,d=e.data(this,"jqxTree").instance;if(!d.disabled&&d.allowDrop){var c=d.vScrollInstance,f=d._hitTestBounds(d,a.left,a.top);if(null!=f&&(i._dragOverItem&&i._dragOverItem.titleElement.removeClass(d.toThemeProperty("jqx-fill-state-hover")),i._dragOverItem=f,f.element)){i.feedbackElement.show();var g=f.top,p=a.top;i._dropPosition="before",p>g+f.height/3&&(g=f.top+f.height/2,i._dragOverItem.titleElement.addClass(i.toThemeProperty("jqx-fill-state-hover")),i.feedbackElement.hide(),i._dropPosition="inside"),p>f.top+f.height-f.height/3&&(g=f.top+f.height,i._dragOverItem.titleElement.removeClass(i.toThemeProperty("jqx-fill-state-hover")),i.feedbackElement.show(),i._dropPosition="after"),i.feedbackElement.css("top",g);var n=-2+parseInt(f.titleElement.offset().left);i.feedbackElement.css("left",n),i.feedbackElement.width(e(f.titleElement).width()+12)}a.left>=n&&a.left<h?(a.top+20>=r&&a.top<=r+d.host.height()&&(o=!1),a.top<r&&a.top>=r-30?(clearInterval(d._autoScrollTimer),0!=c.value&&i.feedbackElement.hide(),d._autoScrollTimer=setInterval(function(){var e=d.panelInstance.scrollUp(),t=d.host.find(".draggable");d._syncItems(t),e||clearInterval(d._autoScrollTimer)},100)):a.top>s&&a.top<s+30?(clearInterval(d._autoScrollTimer),c.value!=c.max&&i.feedbackElement.hide(),d._autoScrollTimer=setInterval(function(){var e=d.panelInstance.scrollDown(),t=d.host.find(".draggable");d._syncItems(t),e||clearInterval(d._autoScrollTimer)},100)):clearInterval(d._autoScrollTimer)):clearInterval(d._autoScrollTimer)}}),o&&i.feedbackElement&&i.feedbackElement.hide()}})},_handleDragEnd:function(t,i){t.off("dragEnd"),t.on("dragEnd",function(t){i.host.find(".draggable");clearInterval(i._autoScrollTimer);var r=(t.args.position,i._trees),s=null,o=e.jqx.mobile.isTouchDevice(),a=o?i._lastDraggingPosition:i._getMouseCoordinates(t);if(i.feedbackElement.remove(),i._dragCancel)return!1;i._dragOverItem&&i._dragOverItem.titleElement.removeClass(i.toThemeProperty("jqx-fill-state-hover")),e.each(r,function(){if(e.jqx.isHidden(e(this)))return!0;var t=parseInt(e(this).offset().left),r=t+e(this).width(),o=e.data(this,"jqxTree").instance;if(clearInterval(o._autoScrollTimer),null!=i._dragItem&&a.left>=t&&a.left<r){var n=parseInt(e(this).offset().top),l=n+e(this).height();a.top>=n&&a.top<=l&&(s=e(this))}});var n=i._dragItem;if(null!=s&&s.length>0){var l=s.jqxTree("allowDrop");if(l){var h=e.data(s[0],"jqxTree").instance,d=i._dragOverItem;if(null!=d&&i._dragOverItem.treeInstance.element.id==h.element.id){var c=!0;if(i.dragEnd&&(c=i.dragEnd(n,d,t.args,i._dropPosition,s),0==c&&(e(t.args.element).jqxDragDrop({triggerEvents:!1}),e(t.args.element).jqxDragDrop("cancelDrag"),clearInterval(i._autoScrollTimer),e(t.args.element).jqxDragDrop({triggerEvents:!0})),void 0==c&&(c=!0)),c){var f=function(){var e=i._dragItem.treeInstance;e._refreshMapping(),e._updateItemsNavigation(),e._render(!0,!1),e.checkboxes&&e._updateCheckStates(),i._dragItem.treeInstance=h,i._syncItems(i._dragItem.treeInstance.host.find(".draggable"))};if("none"!=h.dropAction&&i._dragItem.id!=i._dragOverItem.id)if("inside"==i._dropPosition)h._drop(i._dragItem.element,i._dragOverItem.element,-1,h),f();else{var g=0;"after"==i._dropPosition&&g++,h._drop(i._dragItem.element,i._dragOverItem.parentElement,g+e(i._dragOverItem.element).index(),h),f()}h._render(!0,!1);var p=h.host.find(".draggable");i._syncItems(p),i._dragOverItem=null,i._dragItem=null,h._refreshMapping(),h._updateItemsNavigation(),h.selectedItem=null,h.selectItem(n.element),h.checkboxes&&h._updateCheckStates(),h._render(!0,!1)}}else if("none"!=h.dropAction&&h.allowDrop){var c=!0;if(i.dragEnd&&(c=i.dragEnd(n,d,t.args,i._dropPosition,s),0==c&&(e(t.args.element).jqxDragDrop({triggerEvents:!1}),e(t.args.element).jqxDragDrop("cancelDrag"),clearInterval(i._autoScrollTimer),e(t.args.element).jqxDragDrop({triggerEvents:!0})),void 0==c&&(c=!0)),c){i._dragItem.parentElement=null,h._drop(i._dragItem.element,null,-1,h);var u=i._dragItem.treeInstance;u._refreshMapping(),u._updateItemsNavigation(),u.checkboxes&&u._updateCheckStates();var p=u.host.find(".draggable");i._syncItems(p),i._dragItem.treeInstance=h,h.items[h.items.length]=i._dragItem,h._render(!0,!1),h.selectItem(n.element),h._refreshMapping(),h._updateItemsNavigation();var p=h.host.find(".draggable");h._syncItems(p),h.checkboxes&&h._updateCheckStates(),i._dragOverItem=null,i._dragItem=null}}}}else if(i.dragEnd){var _=i.dragEnd(n,t.args);if(0==_)return!1}return null!=n&&i._raiseEvent(7,{label:n.label,value:n.value,originalEvent:t.args}),!1})},_drop:function(t,i,r,s){if(!(e(i).parents("#"+t.id).length>0||null!=i&&i.id==t.id)){if(s.element.innerHTML.indexOf("UL"))var o=s.host.find("ul:first");if(void 0==i&&null==i)void 0==r||-1==r?o.append(t):0==o.children("li").eq(r).length?o.children("li").eq(r-1).after(t):o.children("li").eq(r)[0].id!=t.id&&o.children("li").eq(r).before(t);
else if(void 0==r||-1==r){i=e(i);var a=i.find("ul:first");if(0==a.length){ulElement=e("<ul></ul>"),e(i).append(ulElement),a=i.find("ul:first");var n=s.itemMapping["id"+i[0].id].item;n.subtreeElement=a[0],n.hasItems=!0,a.addClass(s.toThemeProperty("jqx-tree-dropdown")),a.append(t),t=a.find("li:first"),n.parentElement=t}else a.append(t)}else{i=e(i);var a=i.find("ul:first");if(0==a.length){if(ulElement=e("<ul></ul>"),e(i).append(ulElement),a=i.find("ul:first"),i){var n=s.itemMapping["id"+i[0].id].item;n.subtreeElement=a[0],n.hasItems=!0}a.addClass(s.toThemeProperty("jqx-tree-dropdown")),a.append(t),t=a.find("li:first"),n.parentElement=t}else 0==a.children("li").eq(r).length?a.children("li").eq(r-1).after(t):a.children("li").eq(r)[0].id!=t.id&&a.children("li").eq(r).before(t)}}},_enableDragDrop:function(){if(this.allowDrag&&this.host.jqxDragDrop){var t=this.host.find(".draggable"),i=this;if(t.length>0){t.jqxDragDrop({cursor:"arrow",revertDuration:0,appendTo:"body",dragZIndex:99999,revert:!0,initFeedback:function(t){var r=e('<span style="white-space: nowrap;" class="'+i.toThemeProperty("jqx-fill-state-normal")+'">'+t.text()+"</span>");e(document.body).append(r);var s=r.width();r.remove(),t.width(s+5),t.addClass(i.toThemeProperty("jqx-fill-state-pressed"))}});var r=t.jqxDragDrop("isDestroyed");r&&t.jqxDragDrop("_createDragDrop"),this._autoScrollTimer=null,i._dragItem=null,i._handleDragStart(t,i),i._handleDragging(t,i),i._handleDragEnd(t,i)}}}})}}(jQuery);