(function(){var e,a,t,r,i,o,n,c,s,p,d,u,l,_,h,f,m,g,v,b,w,x,k,y;x=function(){switch("true"===$("#con_arbol").val()&&$.fn.arbolInit(),$.fn.gridRequest(),$(".calcularValores").change(function(){return c()}),$("#rad_operacion_operaciontipo_id").change(function(){return m("I"),b("O"),t()}),$("#rad_operacion_organizacion_id").change(function(){return a()}),$("#action_name").val()){case"new":t();break;case"edit":case"create":$.fn.defineUiXOpTipo()}return $(".agregar_campos_D, .agregar_campos_H").click(function(){var a,t,r,i;return i=(new Date).getTime(),r=new RegExp($(this).data("id"),"g"),null!==$(this).attr("class").match(/agregar_campos_D/g)?(a=".row.debe",t="ContainerDebe"):(a=".row.haber",t="ContainerHaber"),0!==$(a).length?($(a+":last").after($(this).data("fields").replace(r,i)),$(a+":last select").empty().append($(a+":first select option").clone()).trigger("chosen:updated")):$("#container."+t).append($(this).data("fields").replace(r,i)),$.fn.initChosen(),e(!1),k($("#rad_operacion_rdosxmes").prop("checked")),!1}),$("form").on("click",".simil_agrega_campos_D",function(){return $(".agregar_campos_D").click(),!1}),$("form").on("click",".simil_agrega_campos_H",function(){return $(".agregar_campos_H").click(),!1}),$("form").on("click",".quitar_campos",function(){return $(this).parent().prev("input[type=hidden]").val("1"),$(this).closest(".row").remove(),$(".chosen-single:visible")[1].focus(),!1}),$("#rad_operacion_rdosxmes").click(function(){return k($(this).prop("checked"))})},e=function(e){var a;return a=".row."+String(d()),e===!0&&s(a),$(a+" input[name*=valor], #rad_operacion_rdosxmes").change(function(){return s(a)})},i=function(){var e,a,t,r;return a=void 0,t=0,r=-1,e=[],$.each(w(),function(){var i;return i=$(this).data("cuenta"),i===a?t+=parseFloat($(this).data("disponible")):(r+=1,t=parseFloat($(this).data("disponible"))),e[r]={cuenta:i,disponible:t},a=i}),e},w=function(){return $("#aplicaciones option:selected").sort(function(e,a){return $(e).data("cuenta")-$(a).data("cuenta")})},o=function(){var e,a,t,r;if(a=i(),t=f(),r=function(){return $(".row."+t).each(function(e){return $("select."+t,this).val(a[e].cuenta),$("input[type=text]."+t,this).val(a[e].disponible.toFixed(2))}),$(".row."+t+" select").trigger("chosen:updated")},a.length!==$(".row."+t).length)for($(".row."+t).not(":first").empty(),e=a.length;e-=1;)$("a.agregar_campos_"+t[0].toUpperCase()).click();return r()},t=function(){return $.ajax({type:"POST",url:$("#root_path").val()+"rco/cuentas/x_operacion_tipo",data:{operaciontipo_codigo:u()},dataType:"script"})},a=function(){var e;switch($("#action_name").val()){case"edit":e={saldo_tipo:f(),rad_operacion_id:l()};break;case"new":case"create":e={saldo_tipo:f(),organizacion_id:_()}}return $.ajax({type:"POST",url:$("#root_path").val()+"rad/operaciones/compatibles",data:e,dataType:"script"})},r=function(e,a){var t,r;return t="reg_"+e.attr("id"),r=e.data("undefined"===e.data("aplicado")||"onSelect"===a?"disponible":"aplicado"),$("#compatiblesImporte").append("<span>Ref "+e.data("desc")+"</span><input id="+t+" name="+t+' type="text" value="'+r+'">'),$("#compatiblesImporte input").change(function(){return n()})},c=function(e){var a,t,r,i,o,n,c;switch(n="#rad_operacion_",i=$(n+"importe").val(),t=$(n+"cuotas").val(),o=$(n+"cuotaimporte").val(o),u()){case-3:case 2:case-1:a="input.haber";break;case 1:case-2:case 3:a="input.debe"}switch(h()){case!0:c=(t*o).toFixed(2),r="importe",$(a).val(o),$("input."+f()).val(o);break;case!1:c=(i/t).toFixed(2),r="cuotaimporte","edita_registros"===e.solicitante?($("input."+d()).val(i),$("input."+f()).val(i)):$(a).val(i)}return $(n+r).val(c)},n=function(){return $("#rad_operacion_importe").val(0),$("#compatiblesImporte input").each(function(){var e,a,t;return e=$(this).attr("id").substr(4),t=$("#aplicaciones #"+e),parseFloat($(this).val())>parseFloat(t.data("disponible"))&&$(this).val(t.data("disponible")),a=parseFloat($("#rad_operacion_importe").val())+parseFloat($(this).val()),$("#rad_operacion_importe").val(a.toFixed(2)),t.val(e+", "+$(this).val()),o(),c({solicitante:"edita_registros"})})},s=function(e){var a,t;switch(t=0,$.each($(e+" input[name*=valor]"),function(){var e;return e=0,""!==$(this).val()&&(e=$(this).val()),t+=parseInt(e)}),h()){case!0:a="cuotaimporte";break;case!1:a="importe"}return $("#rad_operacion_"+a).val(t.toFixed(2)).change()},p=function(e){switch(e){case"debe":return $(".row.debe:first select option:selected").val();case"haber":return $(".row.haber:first select option:selected").val()}},f=function(){var e;switch(u()){case 1:case-2:case 3:return e="debe";case-3:case 2:case-1:return e="haber"}},d=function(){var e;switch(u()){case-3:case 2:case-1:return e="debe";case 1:case-2:case 3:return e="haber";case 0:return e="movimiento_fondos"}},_=function(){return $("#rad_operacion_organizacion_id").val()},l=function(){return $("#rad_operacion_id").val()},h=function(){return $("#rad_operacion_rdosxmes").prop("checked")},u=function(){return $("#rad_operacion_operaciontipo_id option:selected").data("codigo")},g=function(){var e,a,t;return t=d(),e=!0,$("a.simil_agrega_campos_D, a.agregar_campos_D, .debe a.quitar_campos").show(),$("a.simil_agrega_campos_H, a.agregar_campos_H, .haber a.quitar_campos, .debe a.quitar_campos:first").hide(),"movimiento_fondos"!==t&&$(".row."+t).not(":first").remove(),$("input.debe").prop("readonly",a+!e),$("input.haber").prop("readonly",e),$("[readonly]").prop("tabindex",-1)},m=function(e){var a;return a=y(e),$("#rad_operacion_cuotas, #rad_operacion_cuotaimporte").prop("readonly",!a)},b=function(e){var a;return a=y(e),$("#rad_operacion_rdosxmes").prop("disabled",!a),$("#rad_operacion_rdosxmes").prop("checked",a),k(!a)},v=function(e){switch(e){case"I":return $("#rad_operacion_organizacion_id").prop("disabled",!1).parent().show();case"O":return $("#rad_operacion_organizacion_id").prop("disabled",!0).parent().hide()}},k=function(e){var a;return e===!0&&(a="Valor mensual"),e===!1&&(a="Valor"),$("input[name*=valor]").attr("placeholder",a)},y=function(e){switch(e){case"I":return!0;case"O":return!1}},$.fn.cargaCompatibles=function(e){return $("#compatibles").empty(),$("#compatiblesImporte").empty(),0!==e.length?($("#compatibles").append('<span>Aplicar</span><select  data-placeholder="Seleccionar registros" id="aplicaciones" name="aplicaciones[]" multiple></select>'),$.each(e,function(){var e;return e='<option id="'+this.id+'" value="'+this.id+", "+this.disponible+'" data-disponible="'+this.disponible+'"data-aplicado="'+this.aplicadoATransaccion+'"data-cuenta="'+this.cuenta_id+'"data-desc="'+this.desc+'">'+this.desc+" -- disp: "+this.disponible+" -- venc: "+this.fecha+"</option>",$("#aplicaciones").append(e)}),$("#aplicaciones").change(function(){return $("#compatiblesImporte").empty(),$("#aplicaciones option:selected").each(function(){return r($(this),"onSelect")}),n(),$("#compatiblesImporte input").focus()}),$.fn.initChosen()):void 0},$.fn.defineUiXOpTipo=function(){var t;if(t=u(),0===t)m("O"),b("O"),v("O");else switch(v("I"),a(),t){case 3:case-3:b("I");break;default:b("0")}return g(),e(!0),$("a.agregar_campos_D, a.agregar_campos_H").prop("tabindex",-1)},$.fn.gridRequest=function(e){var a,t;return a=["id","fecha","tipo","importe","desc","cuotaimporte"],t=[["Fecha","20%"],["Tipo","auto"],["Importe","20%"],["desc","auto","Descripci\xf3n"],["cuotaimporte","auto","Cuota"]],$.fn.gridPrepDatos(a,t,e)},$.fn.seleccionaAplicados=function(e){return $("#aplicaciones "+e).prop("selected",!0).trigger("chosen:updated"),$.each($("#aplicaciones "+e),function(){return r($(this),"onRecord")})},$(document).on("page:load",x),$(document).ready(x)}).call(this);