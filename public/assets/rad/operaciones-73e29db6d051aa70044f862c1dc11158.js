(function(){var e,a,r,o,t,i,n,c,s,p,d,u,l,h,_,m,b;m=function(){switch("true"===$("#con_arbol").val()&&$.fn.arbolInit(),$.fn.gridRequest(),$(".calcularValores").change(function(){return n(!1)}),$("#rad_operacion_operaciontipo_id").change(function(){return l(!1),_(!0),o(u()),$.fn.defineUiXOpTipo([u(),void 0])}),$("#action_name").val()){case"new":o(u());break;case"edit":$.fn.defineUiXOpTipo([u(),$("#rad_operacion_id").val()]);break;case"create":$.fn.defineUiXOpTipo([u(),void 0])}return $(".agregar_campos_D, .agregar_campos_H").click(function(){var a,r,o,t;return t=(new Date).getTime(),o=new RegExp($(this).data("id"),"g"),null!==$(this).attr("class").match(/agregar_campos_D/g)?(a=".row.debe",r="ContainerDebe"):(a=".row.haber",r="ContainerHaber"),0!==$(a).length?($(a+":last").after($(this).data("fields").replace(o,t)),$(a+":last select").empty().append($(a+":first select option").clone()).trigger("chosen:updated")):$("#container."+r).append($(this).data("fields").replace(o,t)),$.fn.initChosen(),e(!1),b($("#rad_operacion_rdosxmes").prop("checked")),!1}),$("form").on("click",".simil_agrega_campos_D",function(){return $(".agregar_campos_D").click(),!1}),$("form").on("click",".simil_agrega_campos_H",function(){return $(".agregar_campos_H").click(),!1}),$("form").on("click",".quitar_campos",function(){return $(this).parent().prev("input[type=hidden]").val("1"),$(this).closest(".row").remove(),$(".chosen-single:visible")[1].focus(),!1}),$("#rad_operacion_rdosxmes").click(function(){return b($(this).prop("checked"))})},e=function(e){var a;return a=".row."+String(p()),e===!0&&c(a),$(a+" input[name*=valor], #rad_operacion_rdosxmes").change(function(){return c(a)})},c=function(e){var a,r;switch(r=0,$.each($(e+" input[name*=valor]"),function(){var e;return e=0,""!==$(this).val()&&(e=$(this).val()),r+=parseInt(e)}),d()){case!0:a="cuotaimporte";break;case!1:a="importe"}return $("#rad_operacion_"+a).val(r.toFixed(2)).change()},a=function(e){switch(e){case"debe":return $(".row.debe select, .row.haber select").unbind("change"),$(".row.debe select").change(function(){return r(["buscaPorCta",s("debe"),"debe"])});case"haber":return $(".row.debe select, .row.haber select").unbind("change"),$(".row.haber select").change(function(){return r(["buscaPorCta",s("haber"),"haber"])})}},o=function(e){return $.ajax({type:"POST",url:$("#root_path").val()+"rco/cuentas/x_operacion_tipo",data:{operaciontipo_codigo:e},dataType:"script"})},r=function(e){var a;return a="buscaPorReg"===e[0]?{rad_operacion_id:e[1],saldoTipo:e[2]}:{saldoTipo:e[2],cuenta_id:e[1]},$.ajax({type:"POST",url:$("#root_path").val()+"rad/operaciones/compatibles",data:a,dataType:"script"})},t=function(e,a){var r,o;return r="reg_"+e.attr("id"),o=e.data("undefined"===e.data("aplicado")||"onSelect"===a?"disponible":"aplicado"),$("#compatiblesImporte").append("<span>Ref "+e.data("desc")+"</span><input id="+r+" name="+r+' type="text" value="'+o+'">'),$("#compatiblesImporte input").change(function(){return i()})},n=function(e){var a,r,o,t,i,n,c,s;switch(n=$("#rad_operacion_operaciontipo_id option:selected").data("codigo"),c="#rad_operacion_",t=$(c+"importe").val(),r=$(c+"cuotas").val(),i=$(c+"cuotaimporte").val(i),n){case-3:case 2:case-1:a="input.haber";break;case 1:case-2:case 3:a="input.debe"}switch(d()){case!0:s=(r*i).toFixed(2),o="importe",$(a).val(i);break;case!1:s=(t/r).toFixed(2),o="cuotaimporte",e===!0?$("input.debe, input.haber").val(t):$(a).val(t)}return $(c+o).val(s)},i=function(){return $("#rad_operacion_importe").val(0),$("#compatiblesImporte input").each(function(){var e,a,r;return e=$(this).attr("id").substr(4),r=$("#aplicaciones #"+e),parseFloat($(this).val())>parseFloat(r.data("disponible"))&&$(this).val(r.data("disponible")),a=parseFloat($("#rad_operacion_importe").val())+parseFloat($(this).val()),$("#rad_operacion_importe").val(a.toFixed(2)),r.val(e+", "+$(this).val()),n(!0)})},s=function(e){switch(e){case"debe":return $(".row.debe:first select option:selected").val();case"haber":return $(".row.haber:first select option:selected").val()}},d=function(){return $("#rad_operacion_rdosxmes").prop("checked")},u=function(){return $("#rad_operacion_operaciontipo_id option:selected").data("codigo")},p=function(){var e;switch(u()){case-3:case 2:case-1:return e="debe";case 1:case-2:case 3:return e="haber"}},h=function(e){var a;return"debe"===e?(a=!0,$("a.simil_agrega_campos_D, a.agregar_campos_D, .debe a.quitar_campos").show(),$("a.simil_agrega_campos_H, a.agregar_campos_H, .haber a.quitar_campos, .debe a.quitar_campos:first").hide()):($("a.simil_agrega_campos_H, a.agregar_campos_H, .haber a.quitar_campos").show(),$("a.simil_agrega_campos_D, a.agregar_campos_D, .debe a.quitar_campos, .haber a.quitar_campos:first").hide(),a=!1),$("input.debe").prop("readonly",!a),$("input.haber").prop("readonly",a),$("[readonly]").prop("tabindex",-1)},l=function(e){return $("#rad_operacion_cuotas, #rad_operacion_cuotaimporte").prop("readonly",e)},_=function(e){return $("#rad_operacion_rdosxmes").prop("disabled",e),$("#rad_operacion_rdosxmes").prop("checked",!e),b(!e)},b=function(e){var a;return e===!0&&(a="Valor mensual"),e===!1&&(a="Valor"),$("input[name*=valor]").attr("placeholder",a)},$.fn.cargaCompatibles=function(e){return $("#compatibles").empty(),$("#compatiblesImporte").empty(),0!==e.length?($("#compatibles").append('<span>Aplicar</span><select  data-placeholder="Seleccionar registros" id="aplicaciones" name="aplicaciones[]" multiple></select>'),$.each(e,function(){var e;return e='<option id="'+this.id+'" value="'+this.id+", "+this.disponible+'" data-disponible="'+this.disponible+'"data-aplicado="'+this.aplicadoATransaccion+'"data-desc="'+this.desc+'">'+this.desc+" -- disp: "+this.disponible+" -- venc: "+this.fecha+"</option>",$("#aplicaciones").append(e)}),$("#aplicaciones").change(function(){return $("#compatiblesImporte").empty(),$("#aplicaciones option:selected").each(function(){return t($(this),"onSelect")}),i(),$("#compatiblesImporte input").focus()}),$.fn.initChosen()):void 0},$.fn.defineUiXOpTipo=function(o){switch(o[0]){case 0:l(!0),_(!0);break;case-1:case 2:case-3:_(-3===o[0]?!1:!0),r(void 0===o[1]?["buscaPorCta",s("haber"),"haber"]:["buscaPorReg",o[1],"haber"]),a("haber"),h("debe"),$(".row.haber").not(":first").remove();break;case 1:case-2:case 3:_(3===o[0]?!1:!0),r(void 0===o[1]?["buscaPorCta",s("debe"),"debe"]:["buscaPorReg",o[1],"debe"]),a("debe"),h("haber"),$(".row.debe").not(":first").remove()}return e(!0),$("a.agregar_campos_D, a.agregar_campos_H").prop("tabindex",-1)},$.fn.gridRequest=function(e){var a,r;return a=["id","fecha","tipo","importe","desc","cuotaimporte"],r=[["Fecha","20%"],["Tipo","auto"],["Importe","20%"],["desc","auto","Descripci\xf3n"],["cuotaimporte","auto","Cuota"]],$.fn.gridPrepDatos(a,r,e)},$.fn.seleccionaAplicados=function(e){return $("#aplicaciones "+e).prop("selected",!0).trigger("chosen:updated"),$.each($("#aplicaciones "+e),function(){return t($(this),"onRecord")})},$(document).on("page:load",m),$(document).ready(m)}).call(this);